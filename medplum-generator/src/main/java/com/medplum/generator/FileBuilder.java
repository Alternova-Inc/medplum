package com.medplum.generator;

import org.apache.commons.text.WordUtils;

public class FileBuilder {
    private final String indent;
    private final StringBuilder b;
    private int indentCount;

    public FileBuilder(final String indent) {
        this.indent = indent;

        b = new StringBuilder();
        append("/*");
        append(" * Generated by " + Generator.class.getName());
        append(" * Do not edit manually.");
        append(" */");
        newLine();
    }

    public void increaseIndent() {
        indentCount++;
    }

    public void decreaseIndent() {
        indentCount--;
    }

    public void newLine() {
        b.append("\n");
    }

    public void appendNoWrap(final String line) {
        b.append(indent.repeat(indentCount));
        b.append(line);
        b.append("\n");
    }

    public void append(final String line) {
        final String nowrap = indent.repeat(indentCount) + line;
        if (nowrap.length() < 160) {
            b.append(nowrap);
            b.append("\n");
        } else {
            boolean first = true;
            for (final String wrappedLine : WordUtils.wrap(nowrap, 120 - indent.length() * indentCount).split("\n")) {
                if (first) {
                    b.append(indent.repeat(indentCount));
                } else {
                    b.append(indent.repeat(indentCount + 2));
                }
                b.append(wrappedLine.trim());
                b.append("\n");
                first = false;
            }
        }
    }

    @Override
    public String toString() {
        return b.toString().replaceAll("\n\n\n", "\n\n");
    }
}
